var Tt=Object.create,R=Object.defineProperty,_t=Object.getPrototypeOf,kt=Object.prototype.hasOwnProperty,Et=Object.getOwnPropertyNames,Rt=Object.getOwnPropertyDescriptor;var Z=r=>R(r,"__esModule",{value:!0});var Pt=(r,t)=>{for(var e in t)R(r,e,{get:t[e],enumerable:!0})},Dt=(r,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Et(t))!kt.call(r,n)&&n!=="default"&&R(r,n,{get:()=>t[n],enumerable:!(e=Rt(t,n))||e.enumerable});return r},u=r=>r&&r.__esModule?r:Dt(Z(R(r!=null?Tt(_t(r)):{},"default",{value:r,enumerable:!0})),r);Z(exports);Pt(exports,{activate:()=>Wt});var c=u(require("coc.nvim"));var P=u(require("coc.nvim")),M=class extends P.BasicList{constructor(t){super(t);this.name="ext_list";this.description="CocList for coc-ext-common";this.defaultAction="open";this.actions=[];this.addAction("open",e=>{P.window.showMessage(`${e.label}, ${e.data.name}`)})}async loadItems(t){return[{label:"coc-ext-common list item 1",data:{name:"list item 1"}},{label:"coc-ext-common list item 2",data:{name:"list item 2"}}]}},Y=M;var N=class{constructor(t){this.nvim=t;this.name="vimcommand";this.description="CocList for coc-ext-common (command)";this.defaultAction="execute";this.actions=[];this.actions.push({name:"execute",execute:async e=>{if(Array.isArray(e))return;let{command:n,shabang:o,hasArgs:i}=e.data;if(!i)t.command(n,!0);else{let s=`:${n}${o?"":" "}`;(await t.call("mode")).startsWith("i")?t.command(`call feedkeys("\\<C-O>${s}", 'n')`,!0):await t.feedKeys(s,"n",!0)}}}),this.actions.push({name:"open",execute:async e=>{if(Array.isArray(e))return;let{command:n}=e.data;if(!/^[A-Z]/.test(n))return;let o=await t.eval(`split(execute("verbose command ${n}"),"
")[-1]`);if(/Last\sset\sfrom/.test(o)){let i=o.replace(/^\s+Last\sset\sfrom\s+/,"");t.command(`edit +/${n} ${i}`,!0)}}})}async loadItems(t){let{nvim:e}=this,n=await e.eval(`split(execute("command"),"
")`);n=n.slice(1);let o=[];for(let i of n){let s=i.slice(4).match(/\S+/);if(s==null)continue;let a=s[0],l=i.slice(4+a.length);o.push({label:`${i.slice(0,4)}${a}[3m${l}[23m`,filterText:a,data:{command:a,shabang:i.startsWith("!"),hasArgs:!l.match(/^\s*0\s/)}})}return o}},tt=N;var W=class{constructor(t){this.nvim=t;this.name="vimmapkey";this.description="CocList for coc-ext-common (map key)";this.defaultAction="execute";this.actions=[];this.actions.push({name:"execute",execute:async e=>{}})}async loadItems(t){let{nvim:e}=this,n=await e.eval(`split(execute("map"),"
")`);n=n.slice(1);let o=[];for(let i of n)o.push({label:i,data:{name:"1"}});return o}},et=W;function D(r,t,e,n){return{engine:r,sl:t,tl:e,text:n,explains:[],paraphrase:"",phonetic:""}}var ot=u(require("coc.nvim"));var nt=u(require("coc.nvim"));function p(r,t){return nt.workspace.getConfiguration("coc-ext").get(r,t)}var $t=u(require("path"));function rt(r){return typeof r=="string"?r:r instanceof String?r.toString():JSON.stringify(r,null,2)}var q=u(require("path")),it=class{constructor(){this.channel=ot.window.createOutputChannel("coc-ext"),this.detail=p("log.detail",!1)===!0,this.level=p("log.level",1)}dispose(){return this.channel.dispose()}logLevel(t,e){var s;let n=new Date,o=rt(e);if(this.detail){let a=(s=new Error().stack)==null?void 0:s.split(`
`);if(a&&a.length>=4){let f=/at ((.*) \()?([^:]+):(\d+):(\d+)\)?/g.exec(a[3]);if(f){let g=q.default.basename(f[3]),w=f[4];this.channel.appendLine(`${n.toISOString()} ${t} [${g}:${w}] ${o}`);return}}}let i=q.default.basename(__filename);this.channel.appendLine(`${t} [${i}] ${o}`)}debug(t){this.level>0||this.logLevel("D",t)}info(t){this.level>1||this.logLevel("I",t)}warn(t){this.level>2||this.logLevel("W",t)}error(t){this.logLevel("E",t)}},m=new it;var st=u(require("https"));async function $(r,t){return new Promise(e=>{let n=st.default.request(r,o=>{let i=[];o.on("data",s=>{i.push(s)}),o.on("end",()=>{e({statusCode:o.statusCode,data:Buffer.concat(i),error:void 0})})}).on("error",o=>{e({statusCode:void 0,data:void 0,error:o})});t&&n.write(t),n.end()})}function Bt(r){let t=[],e=r.dict;if(e)for(let n of e){let o=n.pos,i=n.terms.join(", ");t.push(`${o}: ${i}`)}else for(let n of r.sentences)t.push(n.trans);return t.join(`
`)}async function at(r,t,e){let o={hostname:"translate.googleapis.com",path:`/translate_a/single?client=gtx&sl=auto&tl=${e}&dt=at&dt=bd&dt=ex&dt=ld&dt=md&dt=qca&dt=rw&dt=rm&dt=ss&dt=t&dj=1&q=${encodeURIComponent(r)}`,method:"GET",timeout:1e3,headers:{"User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36"}},i=await $(o);if(i.error)return m.error(i.error.message),null;if(!i.data||i.statusCode!=200)return m.error(`status: ${i.statusCode}`),null;let s=JSON.parse(i.data.toString());if(!s)return null;let a=D("Google",t,e,r);return a.paraphrase=Bt(s),a}function At(r){let t=/<span class="ht_pos">(.*?)<\/span><span class="ht_trs">(.*?)<\/span>/g,e=t.exec(r),n=[];for(;e;)n.push(`${e[1]} ${e[2]} `),e=t.exec(r);return n.join(`
`)}async function ct(r,t,e){let n={hostname:"cn.bing.com",path:`/dict/SerpHoverTrans?q=${encodeURIComponent(r)}`,method:"GET",timeout:1e3,headers:{Host:"cn.bing.com",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5"}},o=await $(n);if(o.error)return m.error(o.error.message),null;if(!o.data)return null;let i=D("Bing",t,e,r);return i.paraphrase=At(o.data.toString()),i}var d=u(require("coc.nvim"));var lt=u(require("path")),U=u(require("util")),mt=u(require("fs"));function Lt(){return{autoHide:!0,border:p("window.enableBorder",!1)?[1,1,1,1]:[0,0,0,0],close:!1,maxHeight:p("window.maxHeight",void 0),maxWidth:p("window.maxWidth",void 0)}}async function B(r){let t=await d.workspace.document,e=null;if(r==="v")return(await d.workspace.nvim.call("lib#common#visual_selection",1)).toString().trim();{let o=await d.window.getCursorPosition();e=t.getWordRangeAtPosition(o)}let n="";return e?n=t.textDocument.getText(e):n=(await d.workspace.nvim.eval('expand("<cword>")')).toString(),n.trim()}async function C(r,t,e){if(r.length==0)return;t||(t="text"),e||(e=Lt());let n=[{content:r,filetype:t}];await new d.FloatFactory(d.workspace.nvim).show(n,e)}function It(r,t=0){let e=BigInt(2166136261),n=BigInt(t),o=function(i){n=BigInt.asUintN(32,n*e),n^=BigInt(i)};return typeof r=="string"?new U.TextEncoder().encode(r).forEach(o):r instanceof String?new U.TextEncoder().encode(r.toString()).forEach(o):r.forEach(function(i){n=BigInt.asUintN(32,n*e),n^=BigInt(i)}),Number(n)}function ut(r){return new Promise((t,e)=>{let n=d.Uri.parse(r.uri).fsPath,o=lt.default.extname(n),i=`${n}.${It(r.uri)}${o}`;mt.default.writeFile(i,r.getText(),s=>{s&&e(new Error(`Failed to create a temporary file, ${s.message}`)),t(i)})})}var z=u(require("util"));var ft=u(require("path")),j=u(require("child_process"));async function h(r,t,e){return new Promise(n=>{let o=j.spawn(r,t,{stdio:["pipe","pipe","pipe"]});e&&(o.stdin.write(e),o.stdin.end());let i=0,s=[],a=[];o.stdout.on("data",l=>{s.push(l)}),o.stderr.on("data",l=>{a.push(l)}),o.on("close",l=>{l&&(i=l),n({exitCode:i,data:s.length==0?void 0:Buffer.concat(s),error:a.length==0?void 0:Buffer.concat(a)})})})}async function A(r,t,e,n){return new Promise(o=>{let i=JSON.stringify({m:t,f:e,a:n}),s=process.env.COC_VIMCONFIG;s||(s=".");let a=ft.default.join(s,r,"coc-ext.py"),l=j.spawn("python3",[a],{stdio:["pipe","pipe","pipe"]});l.stdin.write(i),l.stdin.end();let f=0,g=[],w=[];l.stdout.on("data",b=>{g.push(b)}),l.stderr.on("data",b=>{w.push(b)}),l.on("close",b=>{b&&(f=b),o({exitCode:f,data:g.length==0?void 0:Buffer.concat(g),error:w.length==0?void 0:Buffer.concat(w)})})})}function pt(r){let t=/=\?(.+?)\?([BbQq])\?(.+?)\?=/g,e=[],n=t.exec(r);for(;n;)e.push(n),n=t.exec(r);if(e.length==0)return"";let o=[];for(let f of e){let g=f[1],w=f[2],b=f[3];if(w==="B"||w==="b")o.push([g,Buffer.from(b,"base64")]);else{let O=[],X=/(=[A-F0-9]{2}|.)/g,S=X.exec(b);for(;S;)S[1].length==3?O.push(parseInt(S[1].slice(1),16)):O.push(S[1].charCodeAt(0)),S=X.exec(b);o.push([g,Buffer.from(O)])}}if(o.length==0)return"";let i=o[0][0],s=o[0][1],a="";for(let f of o.slice(1))f[0]===i?s=Buffer.concat([s,f[1]]):(a+=new z.TextDecoder(i).decode(s),i=f[0],s=f[1]);return a+=new z.TextDecoder(i).decode(s),a}var dt=u(require("coc.nvim"));var v=u(require("coc.nvim"));var x=class{constructor(t){this.s=t;this.setting=t}};var K=class extends x{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,e,n,o){if(o)return[];let i=v.Uri.parse(t.uri).fsPath,s={};if(this.setting.args)for(let g in this.setting.args)s[g]=this.setting.args[g];e.tabSize!==void 0&&!s.IndentWidth&&(s.IndentWidth=e.tabSize.toString()),e.insertSpaces!==void 0&&!s.UseTab&&(s.UseTab=e.insertSpaces?"false":"true"),s.BasedOnStyle||(s.BasedOnStyle="Google");let a=["-style",JSON.stringify(s),"--assume-filename",i],l=this.setting.exec?this.setting.exec:"clang-format",f=await h(l,a,t.getText());if(f.exitCode!=0)v.window.showMessage(`clang-format fail, ret ${f.exitCode}`),f.error&&m.error(f.error.toString());else if(f.data)return v.window.showMessage("clang-format ok"),[v.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},f.data.toString())];return[]}};var F=u(require("coc.nvim"));var gt=u(require("fs")),H=class extends x{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,e,n,o){if(o)return[];let i=await ut(t),s=[];this.setting.args&&s.push(...this.setting.args),s.push(i);let a=this.setting.exec?this.setting.exec:"prettier",l=await h(a,s);if(gt.default.unlinkSync(i),l.exitCode!=0)F.window.showMessage(`prettier fail, ret ${l.exitCode}`),l.error&&m.error(l.error.toString());else if(l.data)return F.window.showMessage("prettier ok"),[F.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},l.data.toString())];return[]}};var T=u(require("coc.nvim"));var V=class extends x{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,e,n,o){if(o)return[];let i=this.setting.exec?this.setting.exec:"buildifier",s=await h(i,[],t.getText());if(s.exitCode!=0)T.window.showMessage(`buildifier fail, ret ${s.exitCode}`),s.error&&m.error(s.error.toString());else if(s.data)return T.window.showMessage("buildifier ok"),[T.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},s.data.toString())];return[]}};var _=u(require("coc.nvim"));var G=class extends x{constructor(t){super(t);this.setting=t;if(this.opts=[],this.opts_has_indent_width=!1,this.opts_has_usetab=!1,this.setting.args)for(let e of this.setting.args)this.opts.push(e),e.search("indent-width")!=-1?this.opts_has_indent_width=!0:e.search("use-tab")!=-1&&(this.opts_has_usetab=!0)}supportRangeFormat(){return!1}async formatDocument(t,e,n,o){if(o)return[];let i=[];e.tabSize!==void 0&&!this.opts_has_indent_width&&i.push(`--indent-width=${e.tabSize}`),e.insertSpaces!==void 0&&!this.opts_has_usetab&&(e.insertSpaces?i.push("--no-use-tab"):i.push("--use-tab"));let s=this.setting.exec?this.setting.exec:"lua-format",a=await h(s,this.opts.concat(i),t.getText());if(a.exitCode!=0)_.window.showMessage(`lua-format fail, ret ${a.exitCode}`),a.error&&m.error(a.error.toString());else if(a.data)return _.window.showMessage("lua-format ok"),[_.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},a.data.toString())];return[]}};var k=u(require("coc.nvim"));var J=class extends x{constructor(t){super(t);this.setting=t;this.opts=[],this.setting.args&&this.opts.push(...this.setting.args)}supportRangeFormat(){return!1}async formatDocument(t,e,n,o){if(o)return[];let i=this.setting.exec?this.setting.exec:"shfmt",s=await h(i,this.opts,t.getText());if(s.exitCode!=0)k.window.showMessage(`shfmt fail, ret ${s.exitCode}`),s.error&&m.error(s.error.toString());else if(s.data)return k.window.showMessage("shfmt ok"),[k.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},s.data.toString())];return[]}};var Q=class{constructor(t){t.provider=="clang-format"?this.formatter=new K(t):t.provider=="prettier"?this.formatter=new H(t):t.provider=="bazel-buildifier"?this.formatter=new V(t):t.provider=="lua-format"?this.formatter=new G(t):t.provider=="shfmt"?this.formatter=new J(t):this.formatter=null}async _provideEdits(t,e,n,o){return this.formatter?this.formatter.formatDocument(t,e,n,o):(m.error("formatter was null"),dt.window.showMessage("formatter was null"),[])}supportRangeFormat(){return this.formatter?this.formatter.supportRangeFormat():!1}provideDocumentFormattingEdits(t,e,n){return this._provideEdits(t,e,n)}provideDocumentRangeFormattingEdits(t,e,n,o){return this._provideEdits(t,n,o,e)}};var E=u(require("coc.nvim"));var L=u(require("coc.nvim"));var y=u(require("coc.nvim"));async function ht(r){let{nvim:t}=y.workspace,e=r||await t.call("bufnr",["%"]),n=y.workspace.getDocument(e);if(!n||!n.attached||!y.languages.hasProvider("documentSymbol",n.textDocument))return;let o=new y.CancellationTokenSource,{token:i}=o,s=await y.languages.getDocumentSymbol(n.textDocument,i);m.debug(s)}async function xt(){let{nvim:r}=E.workspace,t=await r.call("bufnr","%");await ht(t)}var bt={provider:"clang-format",args:{AlignConsecutiveMacros:"true",AlignEscapedNewlines:"Left",AllowShortFunctionsOnASingleLine:"Inline",BasedOnStyle:"Google",Standard:"C++11"}},I={provider:"prettier",args:["--config-precedence","cli-override","--print-width","80"]},Ot={provider:"bazel-buildifier"},Mt={provider:"lua-format",args:["--column-table-limit=80"]},Nt={provider:"shfmt",args:["-i","4"]},wt={c:bt,cpp:bt,typescript:I,json:I,javascript:I,html:I,bzl:Ot,lua:Mt,sh:Nt};async function yt(r,t,e){var n;if(e.exitCode==0&&e.data){let o=c.TextEdit.replace(t,e.data.toString("utf8"));await r.applyEdits([o])}else m.error((n=e.error)==null?void 0:n.toString("utf8"))}function vt(r){return async()=>{let t=await B(r),e=await at(t,"auto","zh-CN");e||(e=await ct(t,"auto","zh-CN")),e?await C(`[${e.engine}]

${e.paraphrase}`,"ui_float"):await C(`[Error]

translate fail`)}}function St(r){return async()=>{var o;let t=p("pythonDir",""),e=await B("v"),n=await A(t,"coder","decode_str",[e,r]);n.exitCode==0&&n.data?C(`[${r.toUpperCase()} decode]

${n.data.toString("utf8")}`):m.error((o=n.error)==null?void 0:o.toString("utf8"))}}function Ct(r){return async()=>{let t=p("pythonDir",""),e=await c.workspace.document,n=await c.workspace.getSelectedRange("v",e);if(!n)return;let o=e.textDocument.getText(n),i=await A(t,"coder","encode_str",[o,r]);yt(e,n,i)}}function Ft(r,t,e){let n=[{scheme:"file",language:t}],o=new Q(e);r.subscriptions.push(c.languages.registerDocumentFormatProvider(n,o,1)),o.supportRangeFormat()&&r.subscriptions.push(c.languages.registerDocumentRangeFormatProvider(n,o,1))}async function Wt(r){r.logger.info("coc-ext-common works"),m.info("coc-ext-common works"),m.info(c.workspace.getConfiguration("coc-ext.common")),m.info(process.env.COC_VIMCONFIG);let t=new Set;p("formatting",[]).forEach(n=>{n.languages.forEach(o=>{t.add(o),Ft(r,o,n.setting)})});for(let n in wt)t.has(n)||Ft(r,n,wt[n]);r.subscriptions.push(c.commands.registerCommand("ext-debug",xt,{sync:!1}),c.workspace.registerKeymap(["n"],"ext-translate",vt("n"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-translate-v",vt("v"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-encode-utf8",Ct("utf8"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-encode-gbk",Ct("gbk"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-utf8",St("utf8"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-gbk",St("gbk"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-change-name-rule",async()=>{let n=p("pythonDir",""),o=await c.workspace.document,i=await c.workspace.getSelectedRange("v",o);if(!i)return;let s=o.textDocument.getText(i),a=await A(n,"common","change_name_rule",[s]);yt(o,i,a)},{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-mime",async()=>{let n=await B("v"),o=pt(n);C(`[Mime decode]

${o}`,"ui_float")},{sync:!1}),c.listManager.registerList(new Y(c.workspace.nvim)),c.listManager.registerList(new tt(c.workspace.nvim)),c.listManager.registerList(new et(c.workspace.nvim)))}
