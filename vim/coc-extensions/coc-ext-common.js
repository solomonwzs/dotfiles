var yt=Object.create,E=Object.defineProperty,vt=Object.getPrototypeOf,St=Object.prototype.hasOwnProperty,Ct=Object.getOwnPropertyNames,Ft=Object.getOwnPropertyDescriptor;var J=n=>E(n,"__esModule",{value:!0});var Tt=(n,t)=>{for(var e in t)E(n,e,{get:t[e],enumerable:!0})},_t=(n,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Ct(t))!St.call(n,r)&&r!=="default"&&E(n,r,{get:()=>t[r],enumerable:!(e=Ft(t,r))||e.enumerable});return n},u=n=>n&&n.__esModule?n:_t(J(E(n!=null?yt(vt(n)):{},"default",{value:n,enumerable:!0})),n);J(exports);Tt(exports,{activate:()=>It});var c=u(require("coc.nvim"));var R=u(require("coc.nvim")),I=class extends R.BasicList{constructor(t){super(t);this.name="ext_list";this.description="CocList for coc-ext-common";this.defaultAction="open";this.actions=[];this.addAction("open",e=>{R.window.showMessage(`${e.label}, ${e.data.name}`)})}async loadItems(t){return[{label:"coc-ext-common list item 1",data:{name:"list item 1"}},{label:"coc-ext-common list item 2",data:{name:"list item 2"}}]}},Q=I;var O=class{constructor(t){this.nvim=t;this.name="vimcommand";this.description="CocList for coc-ext-common (command)";this.defaultAction="execute";this.actions=[];this.actions.push({name:"execute",execute:async e=>{if(Array.isArray(e))return;let{command:r,shabang:o,hasArgs:i}=e.data;if(!i)t.command(r,!0);else{let s=`:${r}${o?"":" "}`;(await t.call("mode")).startsWith("i")?t.command(`call feedkeys("\\<C-O>${s}", 'n')`,!0):await t.feedKeys(s,"n",!0)}}}),this.actions.push({name:"open",execute:async e=>{if(Array.isArray(e))return;let{command:r}=e.data;if(!/^[A-Z]/.test(r))return;let o=await t.eval(`split(execute("verbose command ${r}"),"
")[-1]`);if(/Last\sset\sfrom/.test(o)){let i=o.replace(/^\s+Last\sset\sfrom\s+/,"");t.command(`edit +/${r} ${i}`,!0)}}})}async loadItems(t){let{nvim:e}=this,r=await e.eval(`split(execute("command"),"
")`);r=r.slice(1);let o=[];for(let i of r){let s=i.slice(4).match(/\S+/);if(s==null)continue;let a=s[0],l=i.slice(4+a.length);o.push({label:`${i.slice(0,4)}${a}[3m${l}[23m`,filterText:a,data:{command:a,shabang:i.startsWith("!"),hasArgs:!l.match(/^\s*0\s/)}})}return o}},X=O;var A=class{constructor(t){this.nvim=t;this.name="vimmapkey";this.description="CocList for coc-ext-common (map key)";this.defaultAction="execute";this.actions=[];this.actions.push({name:"execute",execute:async e=>{}})}async loadItems(t){let{nvim:e}=this,r=await e.eval(`split(execute("map"),"
")`);r=r.slice(1);let o=[];for(let i of r)o.push({label:i,data:{name:"1"}});return o}},Z=A;function $(n,t,e,r){return{engine:n,sl:t,tl:e,text:r,explains:[],paraphrase:"",phonetic:""}}var et=u(require("coc.nvim"));var Y=u(require("coc.nvim"));function p(n,t){return Y.workspace.getConfiguration("coc-ext").get(n,t)}var Et=u(require("path"));function tt(n){return typeof n=="string"?n:n instanceof String?n.toString():JSON.stringify(n,null,2)}var M=u(require("path")),rt=class{constructor(){this.channel=et.window.createOutputChannel("coc-ext"),this.detail=p("log.detail",!1)===!0,this.level=p("log.level",1)}dispose(){return this.channel.dispose()}logLevel(t,e){var s;let r=new Date,o=tt(e);if(this.detail){let a=(s=new Error().stack)==null?void 0:s.split(`
`);if(a&&a.length>=4){let f=/at ((.*) \()?([^:]+):(\d+):(\d+)\)?/g.exec(a[3]);if(f){let g=M.default.basename(f[3]),w=f[4];this.channel.appendLine(`${r.toISOString()} ${t} [${g}:${w}] ${o}`);return}}}let i=M.default.basename(__filename);this.channel.appendLine(`${t} [${i}] ${o}`)}debug(t){this.level>0||this.logLevel("D",t)}info(t){this.level>1||this.logLevel("I",t)}warn(t){this.level>2||this.logLevel("W",t)}error(t){this.logLevel("E",t)}},m=new rt;var nt=u(require("https"));async function k(n,t){return new Promise(e=>{let r=nt.default.request(n,o=>{let i=[];o.on("data",s=>{i.push(s)}),o.on("end",()=>{e({statusCode:o.statusCode,data:Buffer.concat(i),error:void 0})})}).on("error",o=>{e({statusCode:void 0,data:void 0,error:o})});t&&r.write(t),r.end()})}function Rt(n){let t=[],e=n.dict;if(e)for(let r of e){let o=r.pos,i=r.terms.join(", ");t.push(`${o}: ${i}`)}else for(let r of n.sentences)t.push(r.trans);return t.join(`
`)}async function ot(n,t,e){let o={hostname:"translate.googleapis.com",path:`/translate_a/single?client=gtx&sl=auto&tl=${e}&dt=at&dt=bd&dt=ex&dt=ld&dt=md&dt=qca&dt=rw&dt=rm&dt=ss&dt=t&dj=1&q=${encodeURIComponent(n)}`,method:"GET",timeout:1e3,headers:{"User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36"}},i=await k(o);if(i.error)return m.error(i.error.message),null;if(!i.data||i.statusCode!=200)return m.error(`status: ${i.statusCode}`),null;let s=JSON.parse(i.data.toString());if(!s)return null;let a=$("Google",t,e,n);return a.paraphrase=Rt(s),a}function $t(n){let t=/<span class="ht_pos">(.*?)<\/span><span class="ht_trs">(.*?)<\/span>/g,e=t.exec(n),r=[];for(;e;)r.push(`${e[1]} ${e[2]} `),e=t.exec(n);return r.join(`
`)}async function it(n,t,e){let r={hostname:"cn.bing.com",path:`/dict/SerpHoverTrans?q=${encodeURIComponent(n)}`,method:"GET",timeout:1e3,headers:{Host:"cn.bing.com",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5"}},o=await k(r);if(o.error)return m.error(o.error.message),null;if(!o.data)return null;let i=$("Bing",t,e,n);return i.paraphrase=$t(o.data.toString()),i}var d=u(require("coc.nvim"));var st=u(require("path")),N=u(require("util")),at=u(require("fs"));function kt(){return{autoHide:!0,border:p("window.enableBorder",!1)?[1,1,1,1]:[0,0,0,0],close:!1,maxHeight:p("window.maxHeight",void 0),maxWidth:p("window.maxWidth",void 0)}}async function P(n){let t=await d.workspace.document,e=null;if(n==="v")return(await d.workspace.nvim.call("lib#common#visual_selection",1)).toString().trim();{let o=await d.window.getCursorPosition();e=t.getWordRangeAtPosition(o)}let r="";return e?r=t.textDocument.getText(e):r=(await d.workspace.nvim.eval('expand("<cword>")')).toString(),r.trim()}async function S(n,t,e){if(n.length==0)return;t||(t="text"),e||(e=kt());let r=[{content:n,filetype:t}];await new d.FloatFactory(d.workspace.nvim).show(r,e)}function Pt(n,t=0){let e=BigInt(2166136261),r=BigInt(t),o=function(i){r=BigInt.asUintN(32,r*e),r^=BigInt(i)};return typeof n=="string"?new N.TextEncoder().encode(n).forEach(o):n instanceof String?new N.TextEncoder().encode(n.toString()).forEach(o):n.forEach(function(i){r=BigInt.asUintN(32,r*e),r^=BigInt(i)}),Number(r)}function ct(n){return new Promise((t,e)=>{let r=d.Uri.parse(n.uri).fsPath,o=st.default.extname(r),i=`${r}.${Pt(n.uri)}${o}`;at.default.writeFile(i,n.getText(),s=>{s&&e(new Error(`Failed to create a temporary file, ${s.message}`)),t(i)})})}var q=u(require("util"));var lt=u(require("path")),W=u(require("child_process"));async function h(n,t,e){return new Promise(r=>{let o=W.spawn(n,t,{stdio:["pipe","pipe","pipe"]});e&&(o.stdin.write(e),o.stdin.end());let i=0,s=[],a=[];o.stdout.on("data",l=>{s.push(l)}),o.stderr.on("data",l=>{a.push(l)}),o.on("close",l=>{l&&(i=l),r({exitCode:i,data:s.length==0?void 0:Buffer.concat(s),error:a.length==0?void 0:Buffer.concat(a)})})})}async function B(n,t,e,r){return new Promise(o=>{let i=JSON.stringify({m:t,f:e,a:r}),s=process.env.COC_VIMCONFIG;s||(s=".");let a=lt.default.join(s,n,"coc-ext.py"),l=W.spawn("python3",[a],{stdio:["pipe","pipe","pipe"]});l.stdin.write(i),l.stdin.end();let f=0,g=[],w=[];l.stdout.on("data",b=>{g.push(b)}),l.stderr.on("data",b=>{w.push(b)}),l.on("close",b=>{b&&(f=b),o({exitCode:f,data:g.length==0?void 0:Buffer.concat(g),error:w.length==0?void 0:Buffer.concat(w)})})})}function mt(n){let t=/=\?(.+?)\?([BbQq])\?(.+?)\?=/g,e=[],r=t.exec(n);for(;r;)e.push(r),r=t.exec(n);if(e.length==0)return"";let o=[];for(let f of e){let g=f[1],w=f[2],b=f[3];if(w==="B"||w==="b")o.push([g,Buffer.from(b,"base64")]);else{let L=[],G=/(=[A-F0-9]{2}|.)/g,v=G.exec(b);for(;v;)v[1].length==3?L.push(parseInt(v[1].slice(1),16)):L.push(v[1].charCodeAt(0)),v=G.exec(b);o.push([g,Buffer.from(L)])}}if(o.length==0)return"";let i=o[0][0],s=o[0][1],a="";for(let f of o.slice(1))f[0]===i?s=Buffer.concat([s,f[1]]):(a+=new q.TextDecoder(i).decode(s),i=f[0],s=f[1]);return a+=new q.TextDecoder(i).decode(s),a}var ut=u(require("coc.nvim"));var y=u(require("coc.nvim"));var x=class{constructor(t){this.s=t;this.setting=t}};var U=class extends x{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,e,r,o){if(o)return[];let i=y.Uri.parse(t.uri).fsPath,s={};if(this.setting.args)for(let g in this.setting.args)s[g]=this.setting.args[g];e.tabSize!==void 0&&!s.IndentWidth&&(s.IndentWidth=e.tabSize.toString()),e.insertSpaces!==void 0&&!s.UseTab&&(s.UseTab=e.insertSpaces?"false":"true"),s.BasedOnStyle||(s.BasedOnStyle="Google");let a=["-style",JSON.stringify(s),"--assume-filename",i],l=this.setting.exec?this.setting.exec:"clang-format",f=await h(l,a,t.getText());if(f.exitCode!=0)y.window.showMessage(`clang-format fail, ret ${f.exitCode}`),f.error&&m.error(f.error.toString());else if(f.data)return y.window.showMessage("clang-format ok"),[y.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},f.data.toString())];return[]}};var C=u(require("coc.nvim"));var ft=u(require("fs")),j=class extends x{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,e,r,o){if(o)return[];let i=await ct(t),s=[];this.setting.args&&s.push(...this.setting.args),s.push(i);let a=this.setting.exec?this.setting.exec:"prettier",l=await h(a,s);if(ft.default.unlinkSync(i),l.exitCode!=0)C.window.showMessage(`prettier fail, ret ${l.exitCode}`),l.error&&m.error(l.error.toString());else if(l.data)return C.window.showMessage("prettier ok"),[C.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},l.data.toString())];return[]}};var F=u(require("coc.nvim"));var z=class extends x{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,e,r,o){if(o)return[];let i=this.setting.exec?this.setting.exec:"buildifier",s=await h(i,[],t.getText());if(s.exitCode!=0)F.window.showMessage(`buildifier fail, ret ${s.exitCode}`),s.error&&m.error(s.error.toString());else if(s.data)return F.window.showMessage("buildifier ok"),[F.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},s.data.toString())];return[]}};var T=u(require("coc.nvim"));var H=class extends x{constructor(t){super(t);this.setting=t;if(this.opts=[],this.opts_has_indent_width=!1,this.opts_has_usetab=!1,this.setting.args)for(let e of this.setting.args)this.opts.push(e),e.search("indent-width")!=-1?this.opts_has_indent_width=!0:e.search("use-tab")!=-1&&(this.opts_has_usetab=!0)}supportRangeFormat(){return!1}async formatDocument(t,e,r,o){if(o)return[];let i=[];e.tabSize!==void 0&&!this.opts_has_indent_width&&i.push(`--indent-width=${e.tabSize}`),e.insertSpaces!==void 0&&!this.opts_has_usetab&&(e.insertSpaces?i.push("--no-use-tab"):i.push("--use-tab"));let s=this.setting.exec?this.setting.exec:"lua-format",a=await h(s,this.opts.concat(i),t.getText());if(a.exitCode!=0)T.window.showMessage(`lua-format fail, ret ${a.exitCode}`),a.error&&m.error(a.error.toString());else if(a.data)return T.window.showMessage("lua-format ok"),[T.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},a.data.toString())];return[]}};var _=u(require("coc.nvim"));var K=class extends x{constructor(t){super(t);this.setting=t;this.opts=[],this.setting.args&&this.opts.push(...this.setting.args)}supportRangeFormat(){return!1}async formatDocument(t,e,r,o){if(o)return[];let i=this.setting.exec?this.setting.exec:"shfmt",s=await h(i,this.opts,t.getText());if(s.exitCode!=0)_.window.showMessage(`shfmt fail, ret ${s.exitCode}`),s.error&&m.error(s.error.toString());else if(s.data)return _.window.showMessage("shfmt ok"),[_.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},s.data.toString())];return[]}};var V=class{constructor(t){t.provider=="clang-format"?this.formatter=new U(t):t.provider=="prettier"?this.formatter=new j(t):t.provider=="bazel-buildifier"?this.formatter=new z(t):t.provider=="lua-format"?this.formatter=new H(t):t.provider=="shfmt"?this.formatter=new K(t):this.formatter=null}async _provideEdits(t,e,r,o){return this.formatter?this.formatter.formatDocument(t,e,r,o):(m.error("formatter was null"),ut.window.showMessage("formatter was null"),[])}supportRangeFormat(){return this.formatter?this.formatter.supportRangeFormat():!1}provideDocumentFormattingEdits(t,e,r){return this._provideEdits(t,e,r)}provideDocumentRangeFormattingEdits(t,e,r,o){return this._provideEdits(t,r,o,e)}};var pt={provider:"clang-format",args:{AlignConsecutiveMacros:"true",AlignEscapedNewlines:"Left",AllowShortFunctionsOnASingleLine:"Inline",BasedOnStyle:"Google",Standard:"C++11"}},D={provider:"prettier",args:["--config-precedence","cli-override","--print-width","80"]},Bt={provider:"bazel-buildifier"},Dt={provider:"lua-format",args:["--column-table-limit=80"]},Lt={provider:"shfmt",args:["-i","4"]},gt={c:pt,cpp:pt,typescript:D,json:D,javascript:D,html:D,bzl:Bt,lua:Dt,sh:Lt};async function dt(n,t,e){var r;if(e.exitCode==0&&e.data){let o=c.TextEdit.replace(t,e.data.toString("utf8"));await n.applyEdits([o])}else m.error((r=e.error)==null?void 0:r.toString("utf8"))}function ht(n){return async()=>{let t=await P(n),e=await ot(t,"auto","zh-CN");e||(e=await it(t,"auto","zh-CN")),e?await S(`[${e.engine}]

${e.paraphrase}`,"ui_float"):await S(`[Error]

translate fail`)}}function xt(n){return async()=>{var o;let t=p("pythonDir",""),e=await P("v"),r=await B(t,"coder","decode_str",[e,n]);r.exitCode==0&&r.data?S(`[${n.toUpperCase()} decode]

${r.data.toString("utf8")}`):m.error((o=r.error)==null?void 0:o.toString("utf8"))}}function bt(n){return async()=>{let t=p("pythonDir",""),e=await c.workspace.document,r=await c.workspace.getSelectedRange("v",e);if(!r)return;let o=e.textDocument.getText(r),i=await B(t,"coder","encode_str",[o,n]);dt(e,r,i)}}function wt(n,t,e){let r=[{scheme:"file",language:t}],o=new V(e);n.subscriptions.push(c.languages.registerDocumentFormatProvider(r,o,1)),o.supportRangeFormat()&&n.subscriptions.push(c.languages.registerDocumentRangeFormatProvider(r,o,1))}async function It(n){n.logger.info("coc-ext-common works"),m.info("coc-ext-common works"),m.info(c.workspace.getConfiguration("coc-ext.common")),m.info(process.env.COC_VIMCONFIG);let t=new Set;p("formatting",[]).forEach(r=>{r.languages.forEach(o=>{t.add(o),wt(n,o,r.setting)})});for(let r in gt)t.has(r)||wt(n,r,gt[r]);n.subscriptions.push(c.commands.registerCommand("ext-debug",async()=>{await c.window.showQuickpick(["1","2"])},{sync:!1}),c.workspace.registerKeymap(["n"],"ext-translate",ht("n"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-translate-v",ht("v"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-encode-utf8",bt("utf8"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-encode-gbk",bt("gbk"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-utf8",xt("utf8"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-gbk",xt("gbk"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-change-name-rule",async()=>{let r=p("pythonDir",""),o=await c.workspace.document,i=await c.workspace.getSelectedRange("v",o);if(!i)return;let s=o.textDocument.getText(i),a=await B(r,"common","change_name_rule",[s]);dt(o,i,a)},{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-mime",async()=>{let r=await P("v"),o=mt(r);S(`[Mime decode]

${o}`,"ui_float")},{sync:!1}),c.listManager.registerList(new Q(c.workspace.nvim)),c.listManager.registerList(new X(c.workspace.nvim)),c.listManager.registerList(new Z(c.workspace.nvim)))}
