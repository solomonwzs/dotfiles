var kt=Object.create,P=Object.defineProperty,Pt=Object.getPrototypeOf,Et=Object.prototype.hasOwnProperty,Rt=Object.getOwnPropertyNames,Dt=Object.getOwnPropertyDescriptor;var Y=r=>P(r,"__esModule",{value:!0});var Lt=(r,t)=>{for(var n in t)P(r,n,{get:t[n],enumerable:!0})},$t=(r,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of Rt(t))!Et.call(r,e)&&e!=="default"&&P(r,e,{get:()=>t[e],enumerable:!(n=Dt(t,e))||n.enumerable});return r},u=r=>r&&r.__esModule?r:$t(Y(P(r!=null?kt(Pt(r)):{},"default",{value:r,enumerable:!0})),r);Y(exports);Lt(exports,{activate:()=>jt});var c=u(require("coc.nvim"));var N=class{constructor(t){this.nvim=t;this.name="vimcommand";this.description="CocList for coc-ext-common (command)";this.defaultAction="execute";this.actions=[];this.actions.push({name:"execute",execute:async n=>{if(Array.isArray(n))return;let{command:e,shabang:o,hasArgs:i}=n.data;if(!i)t.command(e,!0);else{let s=`:${e}${o?"":" "}`;(await t.call("mode")).startsWith("i")?t.command(`call feedkeys("\\<C-O>${s}", 'n')`,!0):await t.feedKeys(s,"n",!0)}}}),this.actions.push({name:"open",execute:async n=>{if(Array.isArray(n))return;let{command:e}=n.data;if(!/^[A-Z]/.test(e))return;let o=await t.eval(`split(execute("verbose command ${e}"),"
")[-1]`);if(/Last\sset\sfrom/.test(o)){let i=o.replace(/^\s+Last\sset\sfrom\s+/,"");t.command(`edit +/${e} ${i}`,!0)}}})}async loadItems(t){let{nvim:n}=this,e=await n.eval(`split(execute("command"),"
")`);e=e.slice(1);let o=[];for(let i of e){let s=i.slice(4).match(/\S+/);if(s==null)continue;let a=s[0],l=i.slice(4+a.length);o.push({label:`${i.slice(0,4)}${a}[3m${l}[23m`,filterText:a,data:{command:a,shabang:i.startsWith("!"),hasArgs:!l.match(/^\s*0\s/)}})}return o}},tt=N;var E=u(require("coc.nvim")),W=class extends E.BasicList{constructor(t){super(t);this.name="ext_list";this.description="CocList for coc-ext-common";this.defaultAction="open";this.actions=[];this.addAction("open",n=>{E.window.showMessage(`${n.label}, ${n.data.name}`)})}async loadItems(t){return[{label:"coc-ext-common list item 1",data:{name:"list item 1"}},{label:"coc-ext-common list item 2",data:{name:"list item 2"}}]}},et=W;var q=class{constructor(t){this.nvim=t;this.name="vimmapkey";this.description="CocList for coc-ext-common (map key)";this.defaultAction="execute";this.actions=[];this.actions.push({name:"execute",execute:async n=>{}})}async loadItems(t){let{nvim:n}=this,e=await n.eval(`split(execute("map"),"
")`);e=e.slice(1);let o=[];for(let i of e)o.push({label:i,data:{name:"1"}});return o}},nt=q;var rt=u(require("coc.nvim"));function p(r,t){return rt.workspace.getConfiguration("coc-ext").get(r,t)}var pt=u(require("coc.nvim"));var it=u(require("coc.nvim"));var Bt=u(require("path"));function ot(r){return typeof r=="string"?r:r instanceof String?r.toString():JSON.stringify(r,null,2)}var K=u(require("path")),st=class{constructor(){this.channel=it.window.createOutputChannel("coc-ext"),this.detail=p("log.detail",!1)===!0,this.level=p("log.level",1)}dispose(){return this.channel.dispose()}logLevel(t,n){var s;let e=new Date,o=ot(n);if(this.detail){let a=(s=new Error().stack)==null?void 0:s.split(`
`);if(a&&a.length>=4){let f=/at ((.*) \()?([^:]+):(\d+):(\d+)\)?/g.exec(a[3]);if(f){let g=K.default.basename(f[3]),w=f[4];this.channel.appendLine(`${e.toISOString()} ${t} [${g}:${w}] ${o}`);return}}}let i=K.default.basename(__filename);this.channel.appendLine(`${t} [${i}] ${o}`)}debug(t){this.level>0||this.logLevel("D",t)}info(t){this.level>1||this.logLevel("I",t)}warn(t){this.level>2||this.logLevel("W",t)}error(t){this.logLevel("E",t)}},m=new st;var S=u(require("coc.nvim"));var d=class{constructor(t){this.s=t;this.setting=t}};var at=u(require("path")),U=u(require("child_process"));async function h(r,t,n){return new Promise(e=>{let o=U.spawn(r,t,{stdio:["pipe","pipe","pipe"]});n&&(o.stdin.write(n),o.stdin.end());let i=0,s=[],a=[];o.stdout.on("data",l=>{s.push(l)}),o.stderr.on("data",l=>{a.push(l)}),o.on("close",l=>{l&&(i=l),e({exitCode:i,data:s.length==0?void 0:Buffer.concat(s),error:a.length==0?void 0:Buffer.concat(a)})})})}async function R(r,t,n,e){return new Promise(o=>{let i=JSON.stringify({m:t,f:n,a:e}),s=process.env.COC_VIMCONFIG;s||(s=".");let a=at.default.join(s,r,"coc-ext.py"),l=U.spawn("python3",[a],{stdio:["pipe","pipe","pipe"]});l.stdin.write(i),l.stdin.end();let f=0,g=[],w=[];l.stdout.on("data",b=>{g.push(b)}),l.stderr.on("data",b=>{w.push(b)}),l.on("close",b=>{b&&(f=b),o({exitCode:f,data:g.length==0?void 0:Buffer.concat(g),error:w.length==0?void 0:Buffer.concat(w)})})})}var j=class extends d{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,n,e,o){if(o)return[];let i=S.Uri.parse(t.uri).fsPath,s={};if(this.setting.args)for(let g in this.setting.args)s[g]=this.setting.args[g];n.tabSize!==void 0&&!s.IndentWidth&&(s.IndentWidth=n.tabSize.toString()),n.insertSpaces!==void 0&&!s.UseTab&&(s.UseTab=n.insertSpaces?"false":"true"),s.BasedOnStyle||(s.BasedOnStyle="Google");let a=["-style",JSON.stringify(s),"--assume-filename",i],l=this.setting.exec?this.setting.exec:"clang-format",f=await h(l,a,t.getText());if(f.exitCode!=0)S.window.showMessage(`clang-format fail, ret ${f.exitCode}`),f.error&&m.error(f.error.toString());else if(f.data)return S.window.showMessage("clang-format ok"),[S.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},f.data.toString())];return[]}};var F=u(require("coc.nvim"));var x=u(require("coc.nvim"));var ct=u(require("path")),z=u(require("util")),lt=u(require("fs"));function At(){return{autoHide:!0,border:p("window.enableBorder",!0)?[1,1,1,1]:[0,0,0,0],close:!1,maxHeight:p("window.maxHeight",void 0),maxWidth:p("window.maxWidth",void 0)}}function mt(r,t){return(t.start.line<r.line||t.start.line==r.line&&t.start.character<=r.character)&&(r.line<t.end.line||r.line==t.end.line&&r.character<=t.end.character)}async function D(r){let t=await x.workspace.document,n=null;if(r==="v")return(await x.workspace.nvim.call("lib#common#visual_selection",1)).toString().trim();{let o=await x.window.getCursorPosition();n=t.getWordRangeAtPosition(o)}let e="";return n?e=t.textDocument.getText(n):e=(await x.workspace.nvim.eval('expand("<cword>")')).toString(),e.trim()}async function v(r,t,n,e){if(t.length==0)return;n||(n="text"),e||(e=At()),r.length!=0&&(e.title=r);let o=[{content:t,filetype:n}];await new x.FloatFactory(x.workspace.nvim).show(o,e)}function It(r,t=0){let n=BigInt(2166136261),e=BigInt(t),o=function(i){e=BigInt.asUintN(32,e*n),e^=BigInt(i)};return typeof r=="string"?new z.TextEncoder().encode(r).forEach(o):r instanceof String?new z.TextEncoder().encode(r.toString()).forEach(o):r.forEach(function(i){e=BigInt.asUintN(32,e*n),e^=BigInt(i)}),Number(e)}function ut(r){return new Promise((t,n)=>{let e=x.Uri.parse(r.uri).fsPath,o=ct.default.extname(e),i=`${e}.${It(r.uri)}${o}`;lt.default.writeFile(i,r.getText(),s=>{s&&n(new Error(`Failed to create a temporary file, ${s.message}`)),t(i)})})}var ft=u(require("fs")),H=class extends d{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,n,e,o){if(o)return[];let i=await ut(t),s=[];this.setting.args&&s.push(...this.setting.args),s.push(i);let a=this.setting.exec?this.setting.exec:"prettier",l=await h(a,s);if(ft.default.unlinkSync(i),l.exitCode!=0)F.window.showMessage(`prettier fail, ret ${l.exitCode}`),l.error&&m.error(l.error.toString());else if(l.data)return F.window.showMessage("prettier ok"),[F.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},l.data.toString())];return[]}};var T=u(require("coc.nvim"));var V=class extends d{constructor(t){super(t);this.setting=t}supportRangeFormat(){return!1}async formatDocument(t,n,e,o){if(o)return[];let i=this.setting.exec?this.setting.exec:"buildifier",s=await h(i,[],t.getText());if(s.exitCode!=0)T.window.showMessage(`buildifier fail, ret ${s.exitCode}`),s.error&&m.error(s.error.toString());else if(s.data)return T.window.showMessage("buildifier ok"),[T.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},s.data.toString())];return[]}};var _=u(require("coc.nvim"));var G=class extends d{constructor(t){super(t);this.setting=t;if(this.opts=[],this.opts_has_indent_width=!1,this.opts_has_usetab=!1,this.setting.args)for(let n of this.setting.args)this.opts.push(n),n.search("indent-width")!=-1?this.opts_has_indent_width=!0:n.search("use-tab")!=-1&&(this.opts_has_usetab=!0)}supportRangeFormat(){return!1}async formatDocument(t,n,e,o){if(o)return[];let i=[];n.tabSize!==void 0&&!this.opts_has_indent_width&&i.push(`--indent-width=${n.tabSize}`),n.insertSpaces!==void 0&&!this.opts_has_usetab&&(n.insertSpaces?i.push("--no-use-tab"):i.push("--use-tab"));let s=this.setting.exec?this.setting.exec:"lua-format",a=await h(s,this.opts.concat(i),t.getText());if(a.exitCode!=0)_.window.showMessage(`lua-format fail, ret ${a.exitCode}`),a.error&&m.error(a.error.toString());else if(a.data)return _.window.showMessage("lua-format ok"),[_.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},a.data.toString())];return[]}};var k=u(require("coc.nvim"));var J=class extends d{constructor(t){super(t);this.setting=t;this.opts=[],this.setting.args&&this.opts.push(...this.setting.args)}supportRangeFormat(){return!1}async formatDocument(t,n,e,o){if(o)return[];let i=this.setting.exec?this.setting.exec:"shfmt",s=await h(i,this.opts,t.getText());if(s.exitCode!=0)k.window.showMessage(`shfmt fail, ret ${s.exitCode}`),s.error&&m.error(s.error.toString());else if(s.data)return k.window.showMessage("shfmt ok"),[k.TextEdit.replace({start:{line:0,character:0},end:{line:t.lineCount,character:0}},s.data.toString())];return[]}};var Q=class{constructor(t){t.provider=="clang-format"?this.formatter=new j(t):t.provider=="prettier"?this.formatter=new H(t):t.provider=="bazel-buildifier"?this.formatter=new V(t):t.provider=="lua-format"?this.formatter=new G(t):t.provider=="shfmt"?this.formatter=new J(t):this.formatter=null}async _provideEdits(t,n,e,o){return this.formatter?this.formatter.formatDocument(t,n,e,o):(m.error("formatter was null"),pt.window.showMessage("formatter was null"),[])}supportRangeFormat(){return this.formatter?this.formatter.supportRangeFormat():!1}provideDocumentFormattingEdits(t,n,e){return this._provideEdits(t,n,e)}provideDocumentRangeFormattingEdits(t,n,e,o){return this._provideEdits(t,e,o,n)}};function L(r,t,n,e){return{engine:r,sl:t,tl:n,text:e,explains:[],paraphrase:"",phonetic:""}}var gt=u(require("https"));async function $(r,t){return new Promise(n=>{let e=gt.default.request(r,o=>{let i=[];o.on("data",s=>{i.push(s)}),o.on("end",()=>{n({statusCode:o.statusCode,data:Buffer.concat(i),error:void 0})})}).on("error",o=>{n({statusCode:void 0,data:void 0,error:o})});t&&e.write(t),e.end()})}function Ot(r){let t=/<span class="ht_pos">(.*?)<\/span><span class="ht_trs">(.*?)<\/span>/g,n=t.exec(r),e=[];for(;n;)e.push(`${n[1]} ${n[2]} `),n=t.exec(r);return e.join(`
`)}async function dt(r,t,n){let e={hostname:"cn.bing.com",path:`/dict/SerpHoverTrans?q=${encodeURIComponent(r)}`,method:"GET",timeout:1e3,headers:{Host:"cn.bing.com",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.5"}},o=await $(e);if(o.error)return m.error(o.error.message),null;if(!o.data)return null;let i=L("Bing",t,n,r);return i.paraphrase=Ot(o.data.toString()),i}var I=u(require("coc.nvim"));var B=u(require("coc.nvim"));var y=u(require("coc.nvim"));var Mt={1:"File",2:"Module",3:"Namespace",4:"Package",5:"Class",6:"Method",7:"Property",8:"Field",9:"Constructor",10:"Enum",11:"Interface",12:"Function",13:"Variable",14:"Constant",15:"String",16:"Number",17:"Boolean",18:"Array",19:"Object",20:"Key",21:"Null",22:"EnumMember",23:"Struct",24:"Event",25:"Operator",26:"TypeParameter"};async function ht(r){let{nvim:t}=y.workspace,n=r||await t.call("bufnr",["%"]),e=y.workspace.getDocument(n);if(!e||!e.attached||!y.languages.hasProvider("documentSymbol",e.textDocument))return null;let o=new y.CancellationTokenSource,{token:i}=o;return await y.languages.getDocumentSymbol(e.textDocument,i)}async function A(){let r=await ht();if(!r)return null;let t=await y.window.getCursorPosition(),n=[],e=r,o=!0;for(;e&&o;){o=!1;for(let i of e)if(mt(t,i.range)){n.push({name:i.name,detail:i.detail,kind:Mt[i.kind]}),e=i.children,o=!0;break}}return n}async function xt(){let r=await A();m.debug(r)}var X=u(require("util"));function bt(r){let t=/=\?(.+?)\?([BbQq])\?(.+?)\?=/g,n=[],e=t.exec(r);for(;e;)n.push(e),e=t.exec(r);if(n.length==0)return"";let o=[];for(let f of n){let g=f[1],w=f[2],b=f[3];if(w==="B"||w==="b")o.push([g,Buffer.from(b,"base64")]);else{let M=[],Z=/(=[A-F0-9]{2}|.)/g,C=Z.exec(b);for(;C;)C[1].length==3?M.push(parseInt(C[1].slice(1),16)):M.push(C[1].charCodeAt(0)),C=Z.exec(b);o.push([g,Buffer.from(M)])}}if(o.length==0)return"";let i=o[0][0],s=o[0][1],a="";for(let f of o.slice(1))f[0]===i?s=Buffer.concat([s,f[1]]):(a+=new X.TextDecoder(i).decode(s),i=f[0],s=f[1]);return a+=new X.TextDecoder(i).decode(s),a}function Nt(r){let t=[],n=r.dict;if(n)for(let e of n){let o=e.pos,i=e.terms.join(", ");t.push(`${o}: ${i}`)}else for(let e of r.sentences)t.push(e.trans);return t.join(`
`)}async function yt(r,t,n){let o={hostname:"translate.googleapis.com",path:`/translate_a/single?client=gtx&sl=auto&tl=${n}&dt=at&dt=bd&dt=ex&dt=ld&dt=md&dt=qca&dt=rw&dt=rm&dt=ss&dt=t&dj=1&q=${encodeURIComponent(r)}`,method:"GET",timeout:1e3,headers:{"User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36"}},i=await $(o);if(i.error)return m.error(i.error.message),null;if(!i.data||i.statusCode!=200)return m.error(`status: ${i.statusCode}`),null;let s=JSON.parse(i.data.toString());if(!s)return null;let a=L("Google",t,n,r);return a.paraphrase=Nt(s),a}var wt={provider:"clang-format",args:{AlignConsecutiveMacros:"true",AlignEscapedNewlines:"Left",AllowShortFunctionsOnASingleLine:"Inline",BasedOnStyle:"Google",Standard:"C++11"}},O={provider:"prettier",args:["--config-precedence","cli-override","--print-width","80"]},Wt={provider:"bazel-buildifier"},qt={provider:"lua-format",args:["--column-table-limit=80"]},Kt={provider:"shfmt",args:["-i","4"]},St={c:wt,cpp:wt,typescript:O,json:O,javascript:O,html:O,bzl:Wt,lua:qt,sh:Kt};async function vt(r,t,n){var e;if(n.exitCode==0&&n.data){let o=c.TextEdit.replace(t,n.data.toString("utf8"));await r.applyEdits([o])}else m.error((e=n.error)==null?void 0:e.toString("utf8"))}async function Ut(){let r=await A();if(!r)return;let t="";for(let n of r){let e=`[${n.kind[0]}] ${n.name}`;t.length!=0&&(t+=" > "),t+=e}await v("[Symbol]",t)}function Ct(r){return async()=>{let t=await D(r),n=await yt(t,"auto","zh-CN");n||(n=await dt(t,"auto","zh-CN")),n?await v(`[${n.engine}]`,n.paraphrase):await v("[Error]","translate fail")}}function Ft(r){return async()=>{var o;let t=p("pythonDir",""),n=await D("v"),e=await R(t,"coder","decode_str",[n,r]);e.exitCode==0&&e.data?v(`[${r.toUpperCase()} decode]`,e.data.toString("utf8")):m.error((o=e.error)==null?void 0:o.toString("utf8"))}}function Tt(r){return async()=>{let t=p("pythonDir",""),n=await c.workspace.document,e=await c.workspace.getSelectedRange("v",n);if(!e)return;let o=n.textDocument.getText(e),i=await R(t,"coder","encode_str",[o,r]);vt(n,e,i)}}function _t(r,t,n){let e=[{scheme:"file",language:t}],o=new Q(n);r.subscriptions.push(c.languages.registerDocumentFormatProvider(e,o,1)),o.supportRangeFormat()&&r.subscriptions.push(c.languages.registerDocumentRangeFormatProvider(e,o,1))}async function jt(r){r.logger.info("coc-ext-common works"),m.info("coc-ext-common works"),m.info(c.workspace.getConfiguration("coc-ext.common")),m.info(process.env.COC_VIMCONFIG);let t=new Set;p("formatting",[]).forEach(e=>{e.languages.forEach(o=>{t.add(o),_t(r,o,e.setting)})});for(let e in St)t.has(e)||_t(r,e,St[e]);r.subscriptions.push(c.commands.registerCommand("ext-debug",xt,{sync:!1}),c.workspace.registerKeymap(["n"],"ext-cursor-symbol",Ut,{sync:!1}),c.workspace.registerKeymap(["n"],"ext-translate",Ct("n"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-translate-v",Ct("v"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-encode-utf8",Tt("utf8"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-encode-gbk",Tt("gbk"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-utf8",Ft("utf8"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-gbk",Ft("gbk"),{sync:!1}),c.workspace.registerKeymap(["v"],"ext-change-name-rule",async()=>{let e=p("pythonDir",""),o=await c.workspace.document,i=await c.workspace.getSelectedRange("v",o);if(!i)return;let s=o.textDocument.getText(i),a=await R(e,"common","change_name_rule",[s]);vt(o,i,a)},{sync:!1}),c.workspace.registerKeymap(["v"],"ext-decode-mime",async()=>{let e=await D("v"),o=bt(e);v(`[Mime decode]

${o}`,"ui_float")},{sync:!1}),c.listManager.registerList(new et(c.workspace.nvim)),c.listManager.registerList(new tt(c.workspace.nvim)),c.listManager.registerList(new nt(c.workspace.nvim)))}
